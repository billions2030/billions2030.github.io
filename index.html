<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>나의 공모주 관리</title>
    <style>
        body {
            font-family: 'Malgun Gothic', '맑은 고딕', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            box-sizing: border-box;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 25px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #34495e;
        }
        input[type="text"],
        input[type="number"],
        input[type="date"],
        textarea {
            width: calc(100% - 24px);
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
        }
        textarea {
            resize: vertical;
        }
        button {
            background-color: #28a745;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            display: block;
            width: 100%;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #218838;
        }
        #output {
            margin-top: 30px;
            padding: 20px;
            background-color: #e9ecef;
            border-radius: 8px;
            white-space: pre-wrap;
            border: 1px solid #dee2e6;
            color: #495057;
            font-size: 15px;
            line-height: 1.6;
            word-break: break-all;
        }
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 20px;
                border-radius: 8px;
            }
            h1 {
                font-size: 24px;
            }
            input[type="text"], input[type="number"], input[type="date"], textarea, button {
                font-size: 15px;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>나의 공모주 관리표</h1>

        <label for="stockName">종목 이름:</label>
        <input type="text" id="stockName" placeholder="예: 삼성전자">

        <label for="applyDate">청약일:</label>
        <input type="date" id="applyDate">

        <label for="listingDate">상장일:</label>
        <input type="date" id="listingDate">

        <label for="refundDate">환불일:</label>
        <input type="date" id="refundDate">

        <label for="applyQuantity">청약 수량:</label>
        <input type="number" id="applyQuantity" placeholder="예: 100">

        <label for="applyAmount">청약 금액 (원):</label>
        <input type="number" id="applyAmount" placeholder="예: 1000000">

        <label for="allocatedQuantity">배정 수량:</label>
        <input type="number" id="allocatedQuantity" placeholder="예: 50">

        <label for="profitAmount">수익금 (원):</label>
        <input type="number" id="profitAmount" placeholder="예: 50000">

        <label for="memo">메모:</label>
        <textarea id="memo" rows="4" placeholder="특별히 기억하고 싶은 내용을 적어주세요."></textarea>

        <button onclick="saveData()">정보 저장</button>

        <div id="output">
            정보가 저장되면 구글 스프레드시트에서 확인해주세요.
        </div>
    </div>

    <script>
        function saveData() {
            // 각 입력 칸에서 사용자가 입력한 내용을 가져옵니다.
            // 빈 칸이라도 '' (빈 문자열)로 가져와서 저장됩니다.
            const stockName = document.getElementById('stockName').value;
            const applyDate = document.getElementById('applyDate').value;
            const listingDate = document.getElementById('listingDate').value;
            const refundDate = document.getElementById('refundDate').value;
            const applyQuantity = document.getElementById('applyQuantity').value;
            const applyAmount = document.getElementById('applyAmount').value;
            const allocatedQuantity = document.getElementById('allocatedQuantity').value;
            const profitAmount = document.getElementById('profitAmount').value;
            // const lockupPeriod = document.getElementById('lockupPeriod').value; // 필드 제거
            // const lockupReleaseDate = document.getElementById('lockupReleaseDate').value; // 필드 제거
            const memo = document.getElementById('memo').value;

            // N8N 웹훅(Webhook) 주소를 여기에 붙여넣으세요!
            const n8nWebhookUrl = 'https://billions2030.app.n8n.cloud/webhook-test/20d93dac-a61d-4a5f-9525-b626a6630b2b'; // N8N에서 복사한 정확한 Webhook URL로 변경!

            // 입력된 정보들을 하나의 묶음(객체)으로 만듭니다.
            const postData = {
                stockName: stockName,
                applyDate: applyDate,
                listingDate: listingDate,
                refundDate: refundDate,
                applyQuantity: applyQuantity,
                applyAmount: applyAmount,
                allocatedQuantity: allocatedQuantity,
                profitAmount: profitAmount,
                // lockupPeriod: lockupPeriod, // 필드 제거
                // lockupReleaseDate: lockupReleaseDate, // 필드 제거
                memo: memo
            };

            // N8N 웹훅으로 정보를 보내는 부분입니다.
            fetch(n8nWebhookUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(postData)
            })
            .then(response => {
                const contentType = response.headers.get("content-type");
                if (contentType && contentType.indexOf("application/json") !== -1) {
                    return response.json();
                } else {
                    return response.text().then(text => {
                        console.log('N8N Raw Response:', text);
                        return { message: text || 'N8N 응답은 JSON이 아니지만, 전송 시도는 완료되었습니다.' };
                    });
                }
            })
            .then(data => {
                console.log('N8N 응답:', data);
                alert('정보가 성공적으로 저장되었습니다!');

                // 입력창을 비워줍니다.
                document.getElementById('stockName').value = '';
                document.getElementById('applyDate').value = '';
                document.getElementById('listingDate').value = '';
                document.getElementById('refundDate').value = '';
                document.getElementById('applyQuantity').value = '';
                document.getElementById('applyAmount').value = '';
                document.getElementById('allocatedQuantity').value = '';
                document.getElementById('profitAmount').value = '';
                // document.getElementById('lockupPeriod').value = ''; // 필드 제거
                // document.getElementById('lockupReleaseDate').value = ''; // 필드 제거
                document.getElementById('memo').value = '';
            })
            .catch((error) => {
                console.error('정보 저장 중 오류 발생:', error);
                alert('정보 저장에 실패했습니다. 다시 시도해주세요. (콘솔 로그 확인)');
            });
        }
    </script>
</body>
</html>
